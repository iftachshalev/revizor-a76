-![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.001.png)![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.002.png)![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.003.png)![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.004.png)![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.005.png)

**עבודת גמר במקצוע מדעי המחשב**  

**התאמת הרביזור לארכיטקטורת arm**  

**בוצעה במסגרת תכנית " אלפא " בטכניון – מכון טכנולוגי לישראל**  

**מוגשת ע"י : יפתח שלו**  

**מספר זהות: 215631045**  

**כתובת התלמיד: יזרעאל 81 קריית טבעון**  

**דוא"ל התלמיד: iftachshalev30115@gmail.com**  

**נייד התלמיד/ה: 0546395717**  

**ביה"ס )שם וכתובת): אורט טבעון ע"ש גרינברג, קצנלסון 1 קריית טבעון סמל (מס') ביה"ס:  340059**  

**כיתה : י"א**  

**העבודה בוצעה בהנחיית פבל ליפשיץ  במעבדתו של פרופ' מרק זילברשטיין  בפקולטה להנדסת חשמל, בטכניון.**

תודות <a name="_page1_x501.00_y72.00"></a> 

תודה רבה להורי אשר תמכו בי לאורך כל הדרך, הם דחפו אותי להמשיך גם בזמנים הקשים וגידלו אותי להיות מי שאני היום.  

תודה רבה למנחה האישי פבל ליפשיץ שהציג לי את נושא המחקר ועזר לי להתקדם לאורך הדרך. תודה שתמיד היית זמין, זה לא מובן מאליו.  

תודה רבה למנחות הקבוצתיות ד"ר אפרת דינרמן, ד"ר אורנה עטאר ועפרי דופלט פליקשטיין אשר תמכו בי לאורך כל הדרך ועזרו לי לנסח ולכתוב את העבודה.  

תודה לצוות החברתי פבל שאול חבקין, נגה פרדקין, ליאור וקסלר ובראשם עמר בוקצ'ין שסיפקו תמיכה מנטלית והפוגה במהלך השנתיים.  

תודה לראש המעבדה פרופ' מארק זילברשטיין, מנהלת התוכנית דפנה קרטיס הרדוף, מרכז מדעני העתיד וקרן מיימונידיס, האגף למצטיינים ומחוננים במשרד החינוך ובית הספר אורט. בלעדי כל האנשים והגופים שצוינו לא הייתי יכול להשתתף בתוכנית הזאת אז תודה רבה לכולכם.  

הקדמה אישית<a name="_page2_x449.00_y72.00"></a>  

כאשר התחלתי את מחקרי, ניגשתי אליו בהתלהבות רבה מאחר והנושא מאוד מעניין אותי (מזה זמן רב אני עוסק בתחומים דומים). התחום שבחרתי לחקור מאוד רלוונטי וחשוב כיום, כיוון שהוא מהוה חלק גדול ביותר  באבטחת סייבר של חומרה מחשבים, ואני שמח על כך. המחקר פתח בפני תחומים שלא הכרתי ותרם רבות להמשך התעניינותי ועיסוקי בתחום.  

ההכנה למחקר כללה מספר קורסים בטכניון  על מנת  ללמוד  את הבסיס בנושאים  כגו ן  מערכות תוכנה ומערכות הפעלה, מחקר ספרותי מעמיק על נושא הפרצות  והטכניקות אותן הן מנצלות על מנת לפגוע באבטחת המחשב ולבסוף ביצוע המחקר עצמו.  

אמנם יעדי המחקר לא הושלמו לחלוטין אך גם במצבים כאלו יש ערך לימודי ומחקרי. אני מקווה שיתאפשר לי להמשיך בכיווני מחקר דומים בהמשך דרכי המדעית.**  

תוכן עיניינים  

[תודות ............................................................................................................................................... 1 ](#_page1_x501.00_y72.00) [הקדמה אישית .................................................................................................................................. 2 ](#_page2_x449.00_y72.00) [רשימת איורים ................................................................................................................................... 4 ](#_page4_x451.00_y96.00) 

` `[ 5 ........................................................................................................................................ תקציר  .I ](#_page5_x462.00_y72.00) [ 6 ..........................................................................................................................................מבוא  .II ](#_page6_x470.00_y72.00) [ 6 .......................................................................................................................... שאלות המחקר  .III ](#_page6_x409.00_y325.00) [ 6 ........................................................................................................................ השערות המחקר  IV.](#_page6_x363.00_y474.00)

[1  סקירה ספרותית ......................................................................................................................... 7 ](#_page7_x417.00_y72.00) [2  שיטות חומרים וציוד ................................................................................................................. 14 ](#_page14_x396.00_y72.00) 

1. [ניסוי ראשו ן ..................................................................................................................... 14 ](#_page14_x450.00_y100.00) 
1. [ניסוי שני ......................................................................................................................... 15 ](#_page15_x463.00_y72.00) 

` `[ 15 ............................................................... :x86ל arm 2.2.1  הבדלים מרכזיים בין ארכיטקטורת](#_page15_x296.00_y122.00)

2. [המחשב עליו בוצע הניסוי: ............................................................................................. 15 ](#_page15_x385.00_y515.00) 
3. [השינויים שבוצעו ברביזור: ............................................................................................ 16 ](#_page16_x384.00_y418.00) 
3. [התקנה: ....................................................................................................................... 16 ](#_page16_x465.00_y626.00) 
3. [הרצות:......................................................................................................................... 18 ](#_page18_x468.00_y72.00) 

[3  תוצאות .................................................................................................................................... 19 ](#_page19_x471.00_y72.00) 

1. [ניסוי ראשו ן ..................................................................................................................... 19 ](#_page19_x450.00_y174.00) 
1. [ניסוי שני ......................................................................................................................... 22 ](#_page22_x463.00_y72.00) 

[4  דיו ן .......................................................................................................................................... 25 ](#_page25_x496.00_y72.00) [5  רשימת מקורות ספרות ............................................................................................................. 27 ](#_page27_x379.00_y72.00) [6  נספחים .................................................................................................................................... 28 ](#_page28_x469.00_y72.00)  [ 28 .................................................................................. **prime+probe** **6.1**  נספח 1 - מעבדת](#_page28_x336.00_y100.00)

2. [נספח 2 - הגדרות הרביזור בניסוי 1................................................................................. 28 ](#_page28_x327.00_y125.00) 
2. [נספח 3 - קוד לשחזור ומיו ן פרצות................................................................................... 28 ](#_page28_x333.00_y149.00) 
2. [נספח 4 - פרצה 136 ...................................................................................................... 28 ](#_page28_x403.00_y174.00) 
2. [נספח 5 - קלטים המפרים את החוזה של פרצה 136 ....................................................... 28 ](#_page28_x244.00_y198.00) 

` `[ 28 ................................................................................... **base.json (for A76)** - 6 **6.6**  נספח ](#_page28_x340.00_y222.00) [ 28 ................................................................................................. **revizor-A76** - 7 **6.7**  נספח ](#_page28_x387.00_y247.00) [ 28 ........................................................................... **test-nondetection.yaml** - 8 6.8  נספח ](#_page28_x315.00_y271.00)[6.9  נספח 9 – הצעת המחקר ................................................................................................ 28 ](#_page28_x382.00_y296.00) 

רשימת איורים <a name="_page4_x451.00_y96.00"></a> 

[איור 1: דוגמה להרצה ספקולטיבית .................................................................................................... 7 ](#_page7_x345.00_y439.00) 

[איור 2: דוגמא להיררכיית הזיכרון במחשב\[2\] ..................................................................................... 8 ](#_page8_x363.00_y537.00) 

` `[ 10 .................................................................. \]2\[2-way-set- associative-cache איור 3: דוגמה של ](#_page10_x384.00_y325.00) [ 16 .......................................................................................................... A76 איור 4: מבנה הקאש של ](#_page16_x335.00_y138.00) [ 16 ..................................................................................................... A76במחשב mitigations :5 איור](#_page16_x343.00_y369.00)

[איור 6: פרצה 136 .......................................................................................................................... 19 ](#_page19_x314.00_y703.00) 

[איור 7: פרצה 136 ב Pseudocode + דוגמא .................................................................................. 21 ](#_page21_x365.00_y363.00) [איור 8: בדיקת המודלים של הרביזור................................................................................................ 22 ](#_page22_x348.00_y412.00) [איור 9: תוצאות הרצת הרביזור על שני קלטים ותוכנה אחת .............................................................. 23 ](#_page23_x390.00_y225.00) [איור 10: תוצאות הרצת הרביזור עם 2 תוכנות ו2 קלטים .................................................................. 23 ](#_page23_x379.00_y656.00) 

I.  תקציר <a name="_page5_x462.00_y72.00"></a> 

הקאש (cache) הוא בלוק זיכרון במחשב. מטרתו העיקרית היא לאפשר גישה מהירה ויעילה לנתונים, על ידי אחסון מידע אליו תוכנה ניגשת בתדירות גבוהה קרוב למעבד ובכך לגרום לזמן גישה מהיר במיוחד.  

אף על פי שהקאש מציע יתרונות רבים, יש לו גם צד שלילי  -  הוא יכול להוות נקודת חולשה להתקפות המנצלות אותו על מנת לגלות מידע חסוי על תוכנות הפועלות באותו מחשב, ובכך לגלות נתונים כמו סיסמאות ומפתחות הצפנה. התקפות אבטחה כמו spectre ו-meltdown משתמשות בטכניקות מורכבות כגון Flash+reload ו-Prime+probe אשר מאפשרות לתוקפים לחלץ מידע מהקאש ולפעמים אף לפגוע באבטחת המערכת על ידי מדידת זמן הגישה לזיכרון ובכך לגלות איזה מידע כבר נמצא בו.  

ה-revizor הוא מערכת תוכנה שמיועדת לזיהוי התקפות חדשות מהסוגים הנ"ל המתבססות על התקפות ספוקלטיביות. על מנת לזהותן הוא מייצר תוכנות הבנויות מהרבה שורות קוד אקראיות. לכל תכנה מוגדר חוזה המתאר את המידע אשר היא עלולה לחשוף )באופן חוקי( במהלך הרצתה. לאחר מכן, הרביזור מריץ כל תוכנה מספר פעמים, כל פעם עם קלטים אחרים ומבצע טכניקת  prime+probe  על מנת להבין את שינויי הקאש/חומרה להם התוכנה גרמה במהלך הרצתה. אם השינויים של החומרה שונים בין הרצות של אותה תוכנה עם קלטים אחרים, ושינויים אלו לא תוארו בחוזה התוכנה, התוכנה מוגדרת כפרצה. שימוש ברביזור מאפשר למצוא סוגי פרצות לא ידועים, ובכך לאפשר תכנון הגנה )חומרתית או תוכנתית( כלפיהן.  

הרביזור, שמתבצע ברמה נמוכה ומתאים לארכיטקטורה מסוימת, מותאם לעבודה עם מעבדים מסוג x86, ובשלב זה לא ניתן להריץ אותו על מעבדים מסוגים שונים.  

מטרת המחקר  הנוכחי היתה  להתאים את הרביזור לארכיטקטורת arm64  ולהפעיל אותו על מעבדים מסוג זה.  

תחילה הורץ הרביזור בארכיטקטורת x86 במשך 12 שעות ובזמן זה מצא 743 פרצות. מתוך פרצות אלו 345 שוחזרו בהצלחה 5 מתוך 5 פעמים ואחת מהן נחקרה והתגלה כי היא מיישמת את פרצת -spectre

.V1

לאחר מכן הותאם הרביזור להרצה על  arm  בכך שהוחלפו כל חלקי התוכנה התלויים בארכיטקטורה ונבדקה הרצה של הרביזור עם שני קלטים ותכנה אחת אשר הסתיימה בהצלחה. בנוסף, נבדקה הרצה עם שני קלטים ושתי תוכנות אשר גם כן הסתיימה בהצלחה.  

לאחר ההתאמה למעבד A76  הרביזור הורץ בהצלחה מספר פעמים עם הגדרות ריצה  שונות.  הרצה מלאה של הרביזור לא הושלמה בשל חוסר התאמה של הkernel module.  

II. מבוא <a name="_page6_x470.00_y72.00"></a> 

הקאש  הוא "בלוק" של זיכרון קטן יחסית שנמצא קרוב למעבד, ולכן הוא יותר מהיר מהזיכרון המרכזי בכמעט שני סדרי גודל. למרבה הצער, השימוש בקאש גרם לגילויו של ערוץ צד מסוכן מסוג תזמון קאש, הפועל באמצעות מדידת זמן הגישה לזיכרון. אם זמן הגישה יחסית מהיר, סימן שהמידע שניטען נמצא בקאש. ערוץ צד זה מאפשר סוגים רבים של פרצות מסוכנות, בעיה שלה עדיין לא נמצא פתרון יעיל.  

פרצות כמו spectre  ו-meltdown  משתמשות בערוץ הצד של הקאש ופוגעות באבטחת המחשב ובהפרדה הבסיסית בין התוכנות אותן המעבד מריץ. הרביזור הוא fuzzer אשר עוזר במציאת פרצות מהסוגים האלו בכך שהוא מייצר קוד אקראי ומריץ אותו. בו זמנית הוא תוקף את המעבד באמצעות Prime+Probe  ואוסף את השינויים החומרתיים בקאש אשר נגרמו בשל הרצת התוכנה. באמצעות שינויים אלו יש ביכולתו להבין האם התוכנה חושפת מידע סודי ויש להגדיר אותה בתור פרצה.  

III.שאלות המחקר <a name="_page6_x409.00_y325.00"></a> 

הרביזור מוגבל לעבודה על מספר מצומצם של מעבדים (Intel x86) ולכן עלולות להיות עוד  פרצות במעבדים אחרים אליהן אנו איננו מודעים. במחקר הנוכחי, הורחבה פעולתו של הרביזור לפעולה על מעבד מסוג  arm  במטרה לאפשר בעתיד  מציאה של  פרצות שאינן ידועות כיום  המנצלות חולשות של הרצה ספקולטיבית.  

IV.  השערות המחקר <a name="_page6_x363.00_y474.00"></a> 

מחקר זה התעסק בהרחבת פעולת הרביזור כדי לאפשר לו לפעול על מעבדים מסוג arm, במטרה לזהות פרצות שעד כה לא נודעו ואשר משתמשות בחולשות בריצת הקוד הספקולטיבית. דבר זה אמור להיות אפשרי כל עוד כל חלקי הרביזור הקשורים לארכיטקטורה x86 יותאמו או יוחלפו מבלי שפעולתן תפגע.**  

1  סקירה ספרותית <a name="_page7_x417.00_y72.00"></a> 

המעבד, הוא רכיב מרכזי של מחשב המבצע את רוב פעולות החישוב ועיבוד הנתונים של המחשב. רמתו ומהירותו של המעבד נקבעות לפי מהירות השעון של המחשב (GHz) ומספר  ליבותיו. מאז המצאת המחשב קיים צורך ושאיפה רבה לשפר את ביצועיו של המעבד שכן כל שיפור מסוג זה גורם לחוויית משתמש טובה יותר וביצוע משימות חשובות בצורה יעילה ומהירה יותר.  

` `הרצה ספקולטיבית (speculative execution)[1]  זוהי שיטה בה מעבדים משתמשים על מנת לשפר ביצועים. שיטה זו מאפשרת למעבד לבצע פקודות או פעולות אשר עשויות שלא להיות נחוצות באופן מידי, אך יכולות להיות נחוצות בעתיד הקרוב. כאשר המעבד מריץ תוכנה, הוא מבצע חיזוי של תוצאות פקודות התנאי  (if/else)  הקיימות בה. תהליך זה נקרא  branch prediction  וכאשר המעבד חוזה כי תוצאת התנייה מסוימת תהיה true אז תהיה אפשרות להשתמש בהרצה ספקולטיבית על מנת ליעל את הבדיקה. במקרה בו המעבד גילה שפעולות אלו לא היו אמורות להתרחש, הוא מחזיר את תוצאותיהן לאחור ומבטל את השפעותיהן. כך יכול המעבד  לעבוד על פעולות הנחוצות להערכתו, במקום לחכות לביצוע ההוראות באופן מפורש, דבר אשר ישפר את מהירות המערכת כולה.  

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.006.png)

*איור 1:<a name="_page7_x345.00_y439.00"></a> דוגמה להרצה ספקולטיבית*  

בדוגמת הקוד הנראית [באיור  1,](#_page7_x345.00_y439.00) על מנת למצוא את ערך הרשימה במיקום  5,  יש צורך לגשת לזיכרון (פעולה אשר דורשת זמן רב) ולכן, באמצעות שימוש בהרצה ספקולטיבית המעבד יטען את הכתובת תוך כדי בדיקה אם הרשימה במיקום  5  גדולה ב-10. אם יתברר שכן, אז נחסך זמן. במידה ויתברר אחרת הפעולה תתבטל. כך מתאפשר למעבד במקביל גם "להריץ" את הפקודות וגם לבדוק האם הוא צריך באמת לעשות אותן.  

שיטה נוספת המשמשת בעיקר לייעול הגישה לזיכרון היא שימוש בקאש (cache)[2]. הקאש הוא "בלוק" של זיכרון קטן יחסית שנמצא קרוב למעבד, ולכן הוא יותר מהיר מהזיכרון המרכזי בכמעט שני סדרי גודל. הקאש נועד בשביל לייעל את העברת המידע בין הזיכרון למעבד.  

שיטה זו מסתמכת על שני עקרונות מרכזיים:  

1. חזרתיות  )temporal locality(  –  אם תוכנה  טענה את  כתובת  בזיכרון,  היא כנראה תטען אותה שוב בעתיד הקרוב.  
1. סדרתיות  )spatial locality(  –  אם תוכנה טענה את כתובת  X  בזיכרון, היא כנראה תטען את כתובת X+1 או כתובות קרובות נוספות בעתיד הקרוב.  

הקאש בנוי  משלוש "שכבות" (L1, L2, L3) כאשר  L1 הוא המהיר והקטן ביותר ו-L3 הוא הגדול והאיטי 

` `B שורות ובכל שורה קיים בלוק מיידע בגודל E כאשר בכל סט יש )S( ביותר [)איור 2(](#_page8_x363.00_y537.00). קאש בנוי מסטים

- B\*E\*S = )C(בטים. גודל הקאש

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.007.jpeg)

*איור 2<a name="_page8_x363.00_y537.00"></a>: דוגמא להיררכיית הזיכרון במחשב[2]*  

כאשר המעבד מבצע טעינה של כתובת מהזיכרון הוא דבר ראשון בודק אם הכתובת נמצאת ב-L1. בדיקה זאת מתבצעת באמצעות חישוב הסט בוא הכתובת אמורה להיות ובדיקה של כל ה-tags בסט. אם נמצא ה-tag המתאים המעבד מגדיר את המקרה כ-cache hit. אם לא הייתה התאמה, יבוצע אותו החיפוש ב-

` `המעבד  טוען  את  הכתובת  cache miss-אם עדיין  לא  הייתה התאמה,  המקרה מוגדר כ .L3-וב  L2

מהזיכרון לכל שכבות הקאש. הביטים הימניים ביותר של כתובת בזיכרון מסמלים איפה לשמור את הבייט בתוך בלוק B. הביטים לשמאלם מסמלים באיזה סט אפשר לשמור את הבייט )לדוגמא אם הביטים שווים 

tag 400 ויש  30 סטים בקאש, אז הכתובת תשמר בסט  400%30 =  10( ושאר הביטים בכתובת הם ה

- שיאפשרו למחשב להבין איזה כתובת שמורה בשורה מסוימת bits

` `במקרה  בו הסט כבר מלא הוא מבצע הוצאה של שורת קאש על מנת להכניס את  הכתובת. לרוב, אלגוריתם ההחלפה של שורות בקאש מחליף את השורה שאליה היתה הגישה הרחוקה ביותר בעבר 

.)least recently used  – LRU(

קיימים שלושה סוגים עיקריים של קאש:  

` `ולכן צריך  )S=1(  סוג זה יחסית איטי כיוון שבו יש רק סט אחד  –  *Fully-associative cache*  ￿

לבדוק את הtag bits בכל השורות של הקאש.  

` `)E=S( סוג זה מהיר  ביותר כיוון שמספר הסטים שווה למספר השורות  –  *Direct-mapped cache*  ￿

ולכן אין צורך לבדוק את ה-tag bits בכל שורה וכיוון שכל שורה מוציאה את השורה הקודמת לה בסט אין צורך באלגוריתם  החלפה. הבעיה המרכזית בשיטה זו נקראת  conflict-miss  והיא מתממשת כאשר שתיים או יותר כתובות בזיכרון שאמורות להיכנס לאותו הסט נטענות לקאש לסירוגין, וכיוון שהשורה הקודם יוצאת מהקאש כמעט מייד, הקאש מאבד את כל יתרונו על פני הזיכרון.  

` `השיטה הנפוצה ביותר במעבדים מודרניים כיוון שהיא–  *N-way-set-associative  cache*  ￿  N  משלבת את היתרונות של שתי השיטות הנ"ל. בשיטה זו,  יש מספר סטים, כאשר  בכל סט יש

.1 > N של שורות כאשר

נניח שהמחשב מנסה לטעון  את הכתובת  0X123456 וכתובת זו אינה בקאש. נניח גם שבקאש יש  256 סטים, בכל סט 2 שורות, וכל שורה 16 בייטים [(איור 3)](#_page10_x384.00_y325.00).  

המעבד ינסה למצוא את כתובת זו בקאש, ולאחר שיבין שמדובר בcache miss  הוא יביא אותה לקאש מהזיכרון ויברר היכן לשמור אותה: ארבעת הביטים הימניים ביותר בכתובת  (0X6=01102=6)  קובעים שהבייט ישמר בבייט מספר  6 בשורה,  8 הביטים לשמאלם (0X45=010001012=69) יקבעו שהכתובת 

- tag bits-תשמר בסט מספר 69 )69%256=69(. שאר הביטים בכתובת ישמרו במקום של ה

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.008.jpeg)

`  `*]2[2-way-set- associative-cache איור 3<a name="_page10_x384.00_y325.00"></a>: דוגמה של*

cache (  ]4[  ]3[  למרבה הצער, השימוש בקאש גרם לגילויו של ערוץ צד  ]1[  מסוכן מסוג תזמון קאש

- עם פוטנציאל ליצירת תקשורת )מודעת או לא מודעת( בין תוכנות אשר עלולה לחשוף מידע פרטי ,)timing

ערוץ צד הוא כל דבר במערכת חשמלית שיכול להעביר או להדליף מידע. לדוגמה שינוי בלתי נמנע במחשב שתוכנה אחת מבצעת, אשר גם תוכנות אחרות מסוגלות לגשת אליו. לערוצים במערכת יש שני סוגים: ערוצים חוקיים - אלה שנועדו להעברת מידע, וערוצים משניים. דוגמאות לערוצים חוקיים כוללים אינטרנט, זיכרון משותף ועוד. מצב  הקאש והפרשי מתחים הם דוגמאות לערוצים משניים.  כיום קיימות  מספר טכניקות מרכזיות שמאפשרות להבין מיידע על תוכנה אחרת באמצעות הקאש, השתיים המרכזיות ביותר 

- ]6[ Prime+probe-ו ,Flash+reload]5[ הן ללא ספק

` `טכניקה זו מתבססת על שתי תוכנות בעלות זיכרון משותף. תוכנה א' תטען עמוד מהזיכרון :Flash+reload

המשותף לתוך הקאש. לאחר מכן תוכנה ב' תנסה לקרוא את כל העמודים בזיכרון ותמדוד כמה זמן לקח עד שטעינתם הסתיימה. העמוד אותו תוכנה א' טענה לקאש מבעוד מועד יטען במהירות רבה ביחס לאחרים וכך תוכנה א' מסוגלת להעביר לתוכנה ב' ביט אחד באותו הזמן שלוקח לטעון עמוד מהזיכרון.  

` `6[: את שיטה זו ניתן לבצע באמצעות כל שתי תוכנות גם ללא זיכרון משותף, כיוון[ Prime+probe

שבשיטה זו, במקום שתוכנה ב' תבדוק איזה עמודים נמצאים בקאש, היא תבדוק אילו עמודים **אינם**  נמצאים בקאש. על מנת לבצע זאת, תוכנה ב' תמלא את הקאש בזיכרון שלה, ואם הביט שתוכנה א' מנסה להדליף הוא אחד, היא תטען משהו מהזיכרון שלה למיקום מסוים בקאש. לבסוף תוכנה ב' תנסה לטעון את הזיכרון שהוכנס בתחילת התהליך לקאש ותמדוד את זמן הטעינה. מידע שלקח הרבה זמן לטעון אותו מצביע על כך שהוצא מן הקאש על ידי תוכנה א' ועל כך שהביט הוא 1. האלגוריתם הנ"ל ייושם לשם התרגול בנספח 

- receiver.cל sender.c 1 והוא מעביר ביט בין

בעקבות התפתחות טכנולוגיית הקאש וההרצה הספקולטיבית במעבדים, בשנת  2018  התגלו מספר 

` `)flash+reload prime+prove( 8[( מנצלות חולשות אבטחה מסוימות[meltdown, ]7[spectre( פרצות

וגורמות למעבד להריץ הרצה ספקולטיבית באופן המאפשר לתוקפים לגשת לנתונים רגישים המאוחסנים בזיכרון כולל סיסמאות, מפתחות הצפנה וכו'.  

` `מאפשרת לתוקפים ,arm-ו ,AMD ,intel:7[ - פרצה אשר עשויה להשפיע על מעבדים מחברות[ spectre

לגשת לנתונים רגישים באמצעות מניפולציה על המעבד אשר גורמת לו לבצע הרצה ספקולטיבית במקרה בו לא היה עושה זאת. פעולה זו  נעשית על ידי יצירת מצב בו המעבד צריך לבחור בין שני נתיבי ביצוע שונים והתוקף יכול להשפיע על נתיב הביצוע בו המעבד בוחר.  

` `בלבד. באמצעותה, ניתן להשיג מידע של  intel  8[  -  פרצה המשפיעה על מעבדים מחברת[meltdown 

תוכנות אחרות במחשב. תוקף המשתמש בפרצת  meltdown  ינסה לקרוא קטע מידע מכתובת בזיכרון אליה אין לו גישה. מערכת ההפעלה, כמובן, תזהה שפעולה זו אינה חוקית ותחזיר הודעת שגיאה 

` `אך בשלב זה בעקבות הרצה ספקולטיבית המעבד כבר ביצע את הפעולה אבל ,)segmentation fault(

לא יחזיר את המידע לתוקף שכן הפעולה בוטלה. לאחר ביטול הפעולה, המידע שכבר הובא מהזיכרון נשמר בקאש.  

כיום אין בנמצא  דרך טובה מספיק  למציאה של הפרצות הנ"ל, ולכן הומצא הרביזור )revizor(.  הרביזור ]9[ ]10[, הוא מודל לזיהוי פרצות  כמו Spectre או  Meltdown. על מנת לבצע זאת, הרביזור משווה את עקבות החוזה )contract trace( של תוכנה בעלת קטע החשוד להיות פרצה, עם עקבות החומרה 

- שלה, לאחר הרצה עם כמה קלטים שונים )hardware trace(

חוזה [11], הוא מודל המייצג את כל המידע שהמעבד אמור לאפשר ללמוד על תוכנה בעת הרצתה [(טבלה 1)](#_page12_x401.00_y138.00). פלט החוזה נקרא עקבות חוזה.  

*טבלה 1<a name="_page12_x401.00_y138.00"></a>: דוגמא לחוזה של תוכנה המשלבת הרצה ספקולטיבית [10]*  

![ref1]

על מנת למצוא את תוצאות הרצת התוכנה על המעבד (עקבות החומרה) צריך לקרוא את מצב המיקרו ארכיטקטורה של המחשב פעם אחת, ולאחר הרצת התוכנה לעשות זאת שוב וכך לקבל מפת ביטים. במפה כל ביט שהוא 1 מסמל תופעת לוואי של התוכנה על המעבד.  

מטרת הרביזור היא למצוא תוכנה בה יש כמה קלטים שלכולם עקבות חוזה שוות אבל קיים הבדל בעקבות החומרה. כאשר מקרה כזה נוצר, סימן שהקאש מאפשר לתוקף להבין יותר על התוכנה מאשר החוזה מאפשר. מקרה כזה נקרא "מקרה אפקטיבי".  בשביל למצוא כמה שיותר מקרים אפקטיביים, הרביזור מייצר מספר גדול של תוכנות שבנויות בצורה אקראית, ולכול תוכנה הוא ימצא מספר קלטים המייצרים עקבות חוזה שוות.  

הרביזור הוכיח את עצמו כיעיל והצליח למצוא את רוב סוגי הפרצות לאחר כ-  5  עד  120  דקות. תוצאות ההרצה מוצגות ב[-טבלה 2.](#_page13_x468.00_y99.00) עם זאת, הרביזור נבנה בצורה אשר מותאמת לעבודה על מספר מצומצם של מעבדים (Intel x86, x64) למרות שאת עקרון פעולתו ניתן ליישם על כל סוג של מעבד ולכן עלולות להיות עוד דליפות מידע במעבדים אחרים אליהן אנו איננו מודעים. במחקר הנוכחי, תורחב פעולתו של הרביזור לפעולה על מעבד מסוג ארם במטרה להכיר ולמנוע פרצות שאינן ידועות כיום המנצלות חולשות של הרצה ספקולטיבית.  

*טבלה 2<a name="_page13_x468.00_y99.00"></a>: תוצאות הניסוי. סימון X מסמן שהרביזור לא הצליח למצוא פרצה ב-24 השעות הראשונות [10]*

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.010.jpeg)

2  שיטות חומרים וציוד <a name="_page14_x396.00_y72.00"></a> 

1. **ניסוי ראשון <a name="_page14_x450.00_y100.00"></a>** התקנה:  
- python 3.9.0 באמצעות Ubuntu 22.04.3 LTS עם i7-10700k הרביזור הותקן על מעבד

`  `**pip install revizor-fuzzer**

כיוון שהרביזור צריך הרשאות kernel הותקן גם kernel module באמצעות השורות הבאות:  

`  `**sudo apt-get install linux-headers-$(uname -r)**

`  `**git clone https://github.com/microsoft/sca-fuzzer.git   cd sca-fuzzer/src/x86/executor** 

`  `**make uninstall** 

`  `**make clean** 

`  `**make** 

`  `**make install** 

- x86 של ISAבנוסף הותקן קובץ המתאר את ה

**rvzr download\_spec -a x86-64 --extensions BASE SSE SSE2 CLFLUSHOPT   CLFSH --outfile base.json**

- false positives בוטל על מנת להפחית Hyper-Threading BIOSב

הרצה:  

הרביזור הורץ כ-12 שעות באמצעות הפקודה:  

`  `**rvzr fuzz -s base.json -c config.yaml -i 100 -n 100000000 --timeout 43200 -w ./violations --nonstop**

הרביזור הורץ עם קובץ ה-config בנספח 2 המתאר את אופן ההרצה ואופן ההכנה של התוכנות והקלטים האקראיים.  לפי הקובץ ניתן לראות שהמודל של החוזה הוא  ct-seq  כלומר החוזה מאפשר הרצה  **לא** ספקולטיבית  כך שלא תהיה  התייחסות  לחשיפה של מידע תוך הרצה ספקולטיבית. על מנת לנצל את תכונה זו של החוזה הוגדר כי הכמות המקסימלית של הברנצ'ים (CMP)  של כל תוכנה תהיה  5.  במשך כ-12 שעות הרביזור ייצר אלפי קבצי אסמבלי אקראיים, לכל קובץ הוגרלו כמאה קלטים ועבור כל קלט נבדקו עקבות החומרה של התוכנה. אם התברר כי שני קלטים בעלי עקבות חוזה זהים גרמו לעקבות 

.violations חומרה שונים, התוכנה תוגדר כפרצה ותשמר יחד עם הקלטים הרלוונטיים בתיקיית

2. **ניסוי שני <a name="_page15_x463.00_y72.00"></a>** 
- arm בניסוי זה יותאם הרביזור לארכיטקטורת
- x86ל arm 2.2.1  הבדלים מרכזיים בין ארכיטקטורת

  `  `:)ISA( 1. ארכיטקטורת ערכת הוראות

` `בעלת מספר רב של הוראות, כולל .)CISC( היא ארכיטקטורת מחשב של ערכת הוראות מורכבת x86

הוראות באורך משתנה שיכולות לבצע מספר פעולות בהוראה אחת. למחשבי arm יש ארכיטקטורת מחשב מופחתת (RISC). בעלת ערכת הוראות פשוטה יותר בהשוואה ל-x86, עם הוראות באורך קבוע שבדרך כלל מבצעות פעולה אחת לכל הוראה.  

`  `big/little-endian .2

מעבדי x86 משתמשים בסדר הבתים little-endian, כאשר הבתים הכי פחות משמעותיים מאוחסנים 

big--וגם ב little-endian-יכולים לתמוך גם ב ARM בכתובת הזיכרון התחתונה. לעומת זאת מעבדי   .little-endianאך לרוב משתמשים בסדר בתים של ,endian

3. רגיסטרים:  

בארכיטקטורת x86 יש בדרך כלל מספר גדול יותר של רגיסטרים למטרות כלליות, המאפשרים חישוב גמיש ויעיל יותר. לarm יש מספר קטן יותר של רגיסטרים לשימוש כללי, דבר אשר דורש גישה תכופה יותר לזיכרון אך מפחית את גודל השבב ואת צריכת החשמל.  

2. המחשב עליו בוצע הניסוי: <a name="_page15_x385.00_y515.00"></a> 

מחשב raspberry-pi 5 נבחר להתאמת הרביזור. מחשב זה הוא המחשב החדש ביותר מסדרת מחשבי- לוח-יחיד מסוג רספברי פי. מחשב זה כולל מעבד cortex-A76 בעל 4 ליבות המבוסס על ארכיטקטורת 

` `)mitigations( מבנה הקאש של המעבד מתואר [באיור 4.](#_page16_x335.00_y138.00) ההתקפות מהן המחשב מוגן .ARMv8.2-A

מתוארות [באיור 5.](#_page16_x343.00_y369.00)  

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.011.png)

`  `*A76 איור 4<a name="_page16_x335.00_y138.00"></a>: מבנה הקאש של*

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.012.jpeg)

`  `*A76 במחשב mitigations :<a name="_page16_x343.00_y369.00"></a>5 איור*

3. השינויים שבוצעו ברביזור: <a name="_page16_x384.00_y418.00"></a> 

בנוסף לכך כי הקוד אסמבלי בו כתובים חלקים מסוימים של הרביזור צריך להיות מוחלף לארכיטקטורה החדשה גם התוכנות האקראיות אותן הוא מריץ מוחלפות. לשם כך הוחלף הקובץ המתאר את האוסף הפקודות של x86 בקובץ מקביל המותאם ל- arm64. קובץ זה נקרא base.json (נספח 6) והוא מתאר כל פקודה שניתן להריץ על cortex A76 ותכונותיה. מקובץ זה מוגרלות הפקודות שיתווספו לתוכנה האקראית. בנוסף לשינויים אלו תוקנו עוד בעיות רבות בחלקים שונים של הרביזור אשר צצו בעקבות הרצתו על הארכיטקטורה החדשה.  

הגרסה הסופית של הרביזור )המותאם לarm( נמצאת בפרויקט ב-github )נספח 7(.**  

4. התקנה: <a name="_page16_x465.00_y626.00"></a> 

לינוקס ubuntu 23.10 הותקן על כרטיס 32GB[ SD[ באמצעות תוכנת -  

` `kernel 6.5 וחובר למחשב על מנת להשלים את ההתקנה. נעשה שימוש בגרסת "raspberry pi imager"

לאורך הניסוי.  

לאחר ההפעלה הראשונית של המחשב הורצו הפקודות הבאות:  

- **sudo apt update** 
- **sudo apt install python3-pip** 
- **sudo rm /usr/lib/python3.11/EXTERNALLY-MANAGED** 
- **sudo apt install unicorn** 
- **pip3 install --user unicorn** 
- **pip3 install --user pyyaml types-pyyaml numpy** 
- **pip install mypy** 
- **sudo apt install bats** 
- **sudo apt-get install linux-headers-$(uname -r)** 
- **sudo apt install git** 

` `arm -בשלב הבא לאחר התקנת דרישות כפי שהודגם, יש להתקין את גרסת הרביזור המותאמת ל

באמצעות הפקודה הבאה:  

**git clone https://github.com/iftachshalev/revizor-a76.git** 

לפני שמריצים את הרביזור יש להתקין את הkernel module שלו באמצעות הפקודות הבאות:  

- **cd revizor-a76/src/arm64/executor** 
- **make uninstall** (פקודה זו מחזירה שגיאה, אבל זה בסדר) 
- **make clean** 
- **make** 
- **make install** 

ה kernel module יצור בין השאר תיקיית arm64\_executor בתוך sys/ ובה קבצים דרכם חלקים שונים של הרביזור יתקשרו ביניהם.  

5. הרצות: <a name="_page18_x468.00_y72.00"></a> בדיקת מערכת:  

kernel בגרסותיה השונות, ה  spectre  יש להריץ בדיקת מערכת שתבדוק את אפשרות יישום פרצות

- וגם מודלים של הרביזור על מנת לוודא שהכול פועל כשורה module

על מנת להריץ בדיקה זו יש לגשת לתיקיית **revizor-a76/src/tests/** ולהריץ:  

**./runtests.sh** 

אם תוצאות הבדיקה מראות שבערך עד שלושה מהמודלים של הרביזור נכשלו זה הגיוני, אך אם יותר מודלים נכשלו זה סימן שהארכיטקטורה עלולה ליצור בעיות בהרצת הרביזור.  

הרצת שני קלטים ותוכנה אחת:  

הרביזור הורץ בהגדרות של תוכנה אחת, 2 קלטים וקובץ הגדרות שלא מאפשר מציאה של פרצה (נספח 8) באמצעות הפקודה:  

**./cli.py fuzz -s x86/isa\_spec/base.json -i 2 -n 1 -c tests/test-nondetection.yaml** 

הרצת שני קלטים ושתי תוכנות:  

הרביזור הורץ בהגדרות של שתי תוכנות, שני קלטים וקובץ הגדרות שלא מאפשר מציאה של פרצה (נספח 8) באמצעות הפקודה:  

**./cli.py fuzz -s x86/isa\_spec/base.json -i 2 -n 2 -c tests/test-nondetection.yaml** 

- )fuzzing( הרצה מלאה של הרביזור

לאחר מכן הרביזור הורץ עם  100  תוכנות  ו50  קלטים לכל תוכנה עם קובץ  base.json  הנ"ל ועם קובץ הגדרות שלא מאפשר מציאה של פרצה (נספח 8) באמצעות הפקודה:  

**./cli.py fuzz -s x86/isa\_spec/base.json -i 50 -n 100 -c tests/test-nondetection.yaml** 

3  תוצאות <a name="_page19_x471.00_y72.00"></a> 

מטרת המחקר היא  התאמת הרביזור למעבד arm באמצעות הרביזור, לשם כך בניסוי הראשון הרביזור הורץ על מעבד של אינטל, בניסוי השני הרביזור הותאם למעבד arm.  

1. **ניסוי ראשון <a name="_page19_x450.00_y174.00"></a>** 

לאחר הרצה של הרביזור במשך  12 שעות על מעבד  i7-10700k הרביזור מצא כ-743 תוכנות המפרות את החוזה. על מנת לסנן false positives הפרצות שוחזרו 5 פעמים ומוינ ו לפי מספר הפעמים שהשחזור עבר בהצלחה באמצעות הקוד בנספח 3.  

התפלגות (מספר הפעמים שהפרצות שוחזרו בהצלחה – מספר הפרצות):  

- 345 – 5 ,60 – 4 ,64 – 3 ,39 – 2 ,14 – 1 ,221 – 0 

כדי ללמוד על מבנה הפרצות ואופן חקירתן,  פרצה 136 ששוחזרה בהצלחה 5 פעמים (נספח 4) נחקרה.  לאחר צמצום אוטומטי באמצעות הפקודה:  

`  `**rvzr minimize -s base.json -c config.yaml -I vio136.asm -o min136.asm -n 100**

וצמצום ידני של הפרצה שהתקבלה, נשארו כ-  9  שורות אסמבלי אשר מייצגות את הפרצה בצורה האפקטיבית ביותר [(איור 6)](#_page19_x314.00_y703.00)  

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.013.jpeg)

*איור 6<a name="_page19_x314.00_y703.00"></a>: פרצה 136*

הרביזור מחפש הבדלים בחומרה לאחר הרצה של הפרצה עם רגיסטרים המאותחלים )באמצעות פקודות push, pop( עם קלטים שונים בכל הרצה )הקלטים אשר הרביזור מצא שגורמים לפרצה הנ"ל להפר את החוזה מפורטים בנספח 5(.  

כיוון שפרצה זו נמצאה כאשר עקבות החוזה שלה הם מסוג  ct-seq, סביר להניח שהפרצה מתממשת כשהמעבד מבצע הרצה ספקולטיבית על  תנאי (branch) שיקרי, וטוען לקאש  כתובת שתלויה ברגיסטר. כיוון שהרגיסטרים משתנים בין ההרצות כך  בכל הרצה  תטען כתובת אחרת שתשאיר עקבות שונים בחומרה מבלי שהחוזה אפשר זאת, ולכן במקרה כזה מדובר בפרצה.  

התנאי הנ"ל )speculation trigger( נמצא בשורה חמש בפרצה )JNLE .bb\_main.1( והוא יקפוץ לbb\_main.1 רק כאשר JNLE – jump if not less or equal( AL > DL( כלומר המעבד **לא**  יקפוץ כאשר 

` `RCXשני הבייטים האחרונים ב  CX != AX  כאשר )CMPXCHG CX, SI( בשורה שלוש  .AL <= DL

יועתקו לשני הבייטים האחרונים בRAX ולכן גם AL יהיה שווה לCL (הבייט האחרון ברגיסטרים). כלומר במקרה בו CX != SI הפרצה תתממש כאשר CL <= DL.  

כאשר המחשב מבצע את ההרצה הספקולטיבית, הוא טוען לקאש את הכתובת  התלויה ב13  הביטים האחרונים בRCX )שורה 9( כיוון שהשאר אופסו )שורה 8(. אמנם R14 הוא גם רגיסטר, אך הוא מצביע תמיד לתחילת הזיכרון בכל הרצה ומכאן שאין לא משמעות לפרצה.  

[איור  7  ](#_page21_x365.00_y363.00)מציג קוד קריא מעט יותר של פרצה  136  ודוגמא של פעולת הפרצה עם רגיסטרים מאותחלים בקלטים שמספקים את דרישות הפרצה.  

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.014.jpeg)

*איור 7<a name="_page21_x365.00_y363.00"></a>: פרצה 136 ב Pseudocode + דוגמא*  

2. **ניסוי שני <a name="_page22_x463.00_y72.00"></a>** 

לאחר התקנת דרישות המערכת והרביזור המותאם לarm הורצה בדיקת מערכת.  

l1d\_seq,   כפי שניתן לראות, ארבעה מבחנים נכשלו .A76  [איור  8 ](#_page22_x348.00_y412.00)מציג את תוצאות הבדיקה על מעבד  למרות שנכשלו ארבעה מבחנים, הוחלט להמשיך  .)mem\_seq,  rollback\_on\_fence,  ct\_bpas) להשתמש במחשב לביצוע המחקר כיוון שהבדיקות הנ"ל תלויות בארכיטקטורה, ואין דרך לשנות את תוצאתם.  

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.015.jpeg)

*איור 8:<a name="_page22_x348.00_y412.00"></a> בדיקת המודלים של הרביזור*  

לאחר הרצת בדיקות המערכת, הרביזור מוכן להרצה.  

הרביזור הורץ בהגדרות של תוכנה אחת, 2 קלטים וקובץ הגדרות שלא מאפשר מציאה של פרצה (נספח 8) באמצעות הפקודה:  

**./cli.py fuzz -s x86/isa\_spec/base.json -i 2 -n 1 -c tests/test-nondetection.yaml** 

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.016.jpeg)

*איור 9<a name="_page23_x390.00_y225.00"></a>: תוצאות הרצת הרביזור על שני קלטים ותוכנה אחת*  

תוצאות ההרצה [)איור9(](#_page23_x390.00_y225.00) מראות כי הרביזור סיים את פעולתו מבלי למצוא פרצה בתוכנה האקראית )דבר הגיוני  כיוון שהורץ בהגדרות שלא תומכות בכך(, ומוכיחות כי הרביזור מסוגל להריץ תוכנה בעלת יותר מקלט אחד )כל קלט הוא סט של רגיסטרים(, אלו הדרישות המינימליות למציאת פרצה בתוכנה )הרביזור משווה עקבות הרצה של קלטים שונים של אותה התוכנה(.  

לאחר הרצה זו הרביזור הורץ בהגדרות של שתי תוכנות, שני קלטים וקובץ הגדרות שלא מאפשר מציאה של פרצה (נספח 8) באמצעות הפקודה:  

**./cli.py fuzz -s x86/isa\_spec/base.json -i 2 -n 2 -c tests/test-nondetection.yaml** 

![](Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.017.jpeg)

*איור 10:<a name="_page23_x379.00_y656.00"></a> תוצאות הרצת הרביזור עם 2 תוכנות  ו2 קלטים*  

תוצאות ההרצה [)איור 10(](#_page23_x379.00_y656.00) מראות כי הרביזור סיים את פעולתו מבלי למצוא פרצה בתוכנה האקראית )דבר הגיוני כיוון שהורץ בהגדרות שלא תומכות בכך(. הרצה זו מראה כי הרביזור מסוגל לייצר ולבדוק מקבצים של תוכנות בעלות פוטנציאל למציאת פרצה.  

לאחר מכן בוצעה  הרצה מלאה של הרביזור עם הגדרות של 100 תוכנות ו50 קלטים לכל תוכנה עם קובץ 

- הנ"ל ועם קובץ הגדרות שלא מאפשר מציאה של פרצה )נספח 8( באמצעות הפקודה base.json

**./cli.py fuzz -s x86/isa\_spec/base.json -i 50 -n 100 -c tests/test-nondetection.yaml** 

הרצה זו נכשלה מאחר שיחסית מהר הרביזור קרס וגרם למחשב לקרוס גם כן. לאחר בדיקה מעמיקה התגלה כי קריסה זו נגרמת בשל חוסר התאמה של הkernel למערכת הרביזור. חוסר התאמה זה גורם לאחד הקבצים בתיקיית  src/arm64\_executor/  )הקבצים אשר נוצרו על ידי הkernel module  ודרכם חלקים שונים ברביזור מתקשרים( להינעל ולא לאפשר שום אינטראקציה עם אף גורם )זאת לאחר הרצה עם sudo כאשר לקובץ (ששמו trace) יש את כל ההרשאות( הפונקציה אשר מוצאת את עקבות החומרה של תוכנה קוראת את קובץ זה על מנת לקבל אינפורמציה על העקבות אך נתקלת בהודעת שגיאה:  

**cat: trace: Operation not permitted** 

- stack overflow מסוג kernel panic לאחר שגיאה זו הרביזור קורס והמחשב "קופא" או קורס בשל

על מנת לתקן בעיה זו נוסו  שיטות רבות, בניהן החלפת הkernel  לגרסאות אחרות, עדכון מערכת ההפעלה לגרסה החדשה ביותר ופתירת הבעיה בkernel module באמצעות פקודת **printk** שאיתה ניתן "לדבג" קבצי kernel כיוון שהיא מדפיסה לקובץ שניתן לצפות בו באמצעות פקודת **sudo dmesg** בזמן ההרצה. למרות כל הניסיונות, עדיין לא נמצא הפתרון לבעיה.  

4  דיון <a name="_page25_x496.00_y72.00"></a> 

בניסוי הראשון הרביזור הורץ על מעבד  i7-10700k  למשך  12  שעות  כאשר לכל תוכנה אקראית  100 קלטים. במשך זמן זה הרביזור מצא כ-743 פרצות מתוכן 345 שוחזרו בהצלחה 5 מתוך 5 פעמים. לשם הדגמת פרצה, אחת הפרצות נחקרה והתגלה כי היא מסוג spectre-v1 הנפוץ ביותר.  

לאחר מכן, בניסוי השני, הרביזור הותאם לארכיטקטורת  arm  והופעל על מעבד  A76. הרביזור  ביצע 

` `בהצלחה לשתי תוכנות אקראיות אשר לכל אחת שני קלטים. חיפוש גדול אחר פרצות כמו  fuzzing

שהתבצע בניסוי הראשון עדיין אינו אפשרי בגלל חוסר התאמה של הkernel הגורם לרביזור לקרוס לאחר בדיקה של תוכנות בודדות.  

חוץ מההבדלים הברורים בISA של arm ביחס ל- x86 יש עוד נושאים אליהם יש להתייחס על מנת להבין את התוצאות:  

**קאש**: פרצות כמו Spectre מנצלות את הקאש של המעבד כדי לחשוף מידע רגיש. אם תוצאות הבדיקות מראות שהרביזור לא מצליח לגלות פרצות בתוכנות ספציפיות  אשר בוודאות מיישמות פרצה זו, ייתכן 

replacement   לדוגמא( x86  לעומת  arm  והבעיה נובעת מהתנהגות שונה של הקאש בארכיטקטורת  הקאש יכול להיות מאורגן בצורה שונה בארכיטקטורות שונות, ויתכן כי הרביזור לא מצליח לזהות .)policy

- (A76) arm את ההתנהגות המיוחדת של

**ביצוע ספקולטיבי**:  ביצוע ספקולטיבי הוא טכניקה בה מעבד מנסה לחזות את ההוראות הבאות שירוצו ובכך להאיץ את הביצועים. עם זאת, טכניקה זו יכולה ליצור בעיות אבטחה כמו פרצות  Spectre, שבהן מנוצלת העובדה שהמעבד מבצע הוראות שעדיין לא וידא אם הן תקפות או לא. אם תוצאות בדיקה  הרביזור מראות  כי  מספר מבחנים נכשלו (כמו  l1d\_seq, mem\_seq, rollback\_on\_fence, ct\_bpas), ייתכן שהארכיטקטורה של arm  לא מצליחה להתמודד עם ההתנהגות הספקולטיבית של המעבד באותם מקרים.  

**קרנל**:  קריסות הרביזור המובילות לקריסות של המערכת עצמה יכולות להצביע על בעיות עמוקות יותר בתאימות הקרנל למערכת הרביזור. הקרנל של  arm  עשוי לא להיות מותאם בצורה מלאה לדרישות 

` `)trace( הספציפיות של הרביזור, במיוחד אם מדובר בגרסאות קרנל שונות. ההודעה על קובץ נעול

והקריסה בעקבותיה מצביעות על כך שהקרנל לא מצליח לטפל במעבר המידע בין מודול הקרנל לרביזור בצורה נכונה.  

` `הם  אמצעי אבטחה אשר נועדו להתמודד עם בעיית הפרצות המנצלות את  mitigations  :**Mitigations**

הקאש. כאשר מתגלה פרצה מהסוג הנ"ל מתבצע פיתוח של חסימות והגנות ממנה על מנת שמאוחר יותר יהיה אפשרי ליישם אותן באמצעות עדכוני תוכנה (בהנחה שהן לא גורמות לבעיות משמעותיות בביצועים של המעבד) ובכך להגן או להחליש את השפעת הפריצה.[ איור 5 ](#_page16_x343.00_y369.00)כולל דוגמא של הmitigation על מעבד 

Cortex-A76  עליו בוצע הניסוי. ניתן לראות את הפרצות אשר המעבד מוגן או חשוף אליהן באמצעות פקודת **lscpu**. הגנות אלו אמנם עלולות להקשות (או למנוע לחלוטין) על הרביזור למצוא פרצות מסוימות בתהליך הfuzzing שלו, אך גילוי פרצות ידועות/מוגנות מעולם לא הייתה מטרתו של הרביזור, אלא מציאה של פרצות לא ידועות אשר מעמידות את המחשב בפני סיכון  מהותי  מצד תוכנות זדוניות, וכך לאפשר פיתוח של הגנה מתאימה.  

**מסקנות:**  

יש לזכור כי  אין זה משנה לכמה זמן מריצים את הרביזור, אין ביכולתו  **להוכיח**  את אבטחת המערכת. כלומר, גם אם הוא הורץ במשך זמן ממושך ביותר על מעבד מסוים מבלי למצוא פרצה, לא ניתן לומר כי המעבד מאובטח מפריצות מהסוג הזה כיוון שאפשרי שבכל זמן ההרצה לא קרה שנבנתה פרצה זו באחת התוכנות האקראיות אותן הרביזור מריץ,  או לא הוגרלו הקלטים אותם התוכנה טוענת באופן שונה ובכך חושפת את ערכיהם.  

למרות שבסוף המחקר הרצה מלאה של הרביזור לא מצאה פרצות בשל הקריסות החוזרות ונשנות, לשיטה בה הרביזור פועל )fuzzing( יש הרבה פוטנציאל במציאת פרצות חדשות. זאת ניתן לומר בזכות הקלות בה הוא מוצא פרצות קיימות ופרצות חדשות )SCO, ZDI(. לכן, כדאי לפתח את שיטה זו בכיוונים חדשים על מנת להגדיל את סיכויי מציאת הפרצה. לדוגמא, אפשר לפתח את הexecutor של הרביזור כך שיבצע prime+probe  גם לL2  ו-L3  וכך יוכל לאסוף עקבות חומרה רבים יותר מהרצה אחת ותאורטית למצוא פרצות שלא מתממשות בL1 אבל כן בשכבות אחרות של הקאש.  

5  רשימת מקורות ספרות <a name="_page27_x379.00_y72.00"></a> 

1. intel, “Refined Speculative Execution Terminology.” Accessed: Jun. 16, 2023. [Online]. Available: https://www.intel.com/content/www/us/en/developer/articles/technical/software- security-guidance/best-practices/refined-speculative-execution-terminology.html 
1. R. E. Bryant and D. R. (Davie R. O’Hallaron, *Computer systems : a programmer’s perspective*.  
1. Yunjing Xu, Michael Bailey, Farnam Jahanian, M. H. Kaustubh Joshi, and Richard Schlichting, “An Exploration of L2 Cache Covert Channels in Virtualized Environments,” p. 130. 
1. Q. Ge, Y. Yarom, D. Cock, and G. Heiser, “A Survey of Microarchitectural Timing Attacks and Countermeasures on Contemporary Hardware.” 
1. Y. Yarom and K. Falkner, “FLUSH+RELOAD: a High Resolution, Low Noise, L3 Cache Side-Channel Attack.” 
1. C. Percival, “CACHE MISSING FOR FUN AND PROFIT.” 
1. D. Genkin *et al.*, “Spectre Attacks: Exploiting Speculative Execution.” [Online]. Available: https://www.researchgate.net/publication/322253254 
1. M. Lipp *et al.*, *Meltdown: Reading Kernel Memory from User Space*. [Online]. Available: https://www.usenix.org/conference/usenixsecurity18/presentation/lipp 
1. O. Oleksenko, M. Guarnieri, B. Köpf, and M. Silberstein, “Hide and Seek with Spectres: Efficient discovery of speculative information leaks with random testing,” Jan. 2023, [Online]. Available: http://arxiv.org/abs/2301.07642 
1. O. Oleksenko, C. Fetzer, B. Köpf, and M. Silberstein, “Revizor: Testing Black-box CPUs against Speculation Contracts,” May 2021, [Online]. Available: http://arxiv.org/abs/2105.06872 
1. M. Guarnieri, B. Köpf, J. Reineke, and P. Vila, “Hardware-Software Contracts for Secure Speculation,” Jun. 2020, [Online]. Available: http://arxiv.org/abs/2006.03841 

6  נספחים <a name="_page28_x469.00_y72.00"></a> 

` `**<a name="_page28_x336.00_y100.00"></a>[ prime+probe ](https://github.com/iftachshalev/CacheTimeingLab1/tree/master/prime%2Bprobe%20example/CacheMissing-DeadDrop)6.1  נספח 1 -[ מעבדת**](https://github.com/iftachshalev/CacheTimeingLab1/tree/master/prime%2Bprobe%20example/CacheMissing-DeadDrop)**

2. **נספח 2 -[ הגדרות הרביזור בניסוי 1 ](https://github.com/iftachshalev/alpha-revizor-results/blob/main/ex1/i7-10700-hp-disabled/i7-10700-5b-no-hp.yaml)<a name="_page28_x327.00_y125.00"></a>** 
2. **נספח 3 -[ קוד לשחזור ומיון פרצות ](https://github.com/iftachshalev/alpha-revizor-results/blob/main/ex1/rep.py)<a name="_page28_x333.00_y149.00"></a>** 
2. **נספח 4 -[ פרצה 136 ](https://github.com/iftachshalev/alpha-revizor-results/blob/main/ex1/analize/vio136/vio136.asm)<a name="_page28_x403.00_y174.00"></a>** 
2. **נספח 5 -[ קלטים המפרים את החוזה של פרצה 136 ](https://github.com/iftachshalev/alpha-revizor-results/blob/main/ex1/analize/trace_after_min.txt)<a name="_page28_x244.00_y198.00"></a>** 

` `**<a name="_page28_x340.00_y222.00"></a>[ base.json (for A76) ](https://github.com/iftachshalev/revizor-a76/blob/master/src/arm64/isa_spec/base.json)- 6 6.6  נספח  <a name="_page28_x387.00_y247.00"></a>[ revizor-A76 ](https://github.com/iftachshalev/revizor-a76/tree/master)- 7 6.7  נספח**

` `**<a name="_page28_x315.00_y271.00"></a>[ test-nondetection.yaml ](https://github.com/iftachshalev/revizor-a76/blob/master/src/tests/test-nondetection.yaml)- 8 6.8  נספח**

**6.9**  **נספח 9 – הצעת המחקר <a name="_page28_x382.00_y296.00"></a>** 

**הצעת עבודת הגמר בבחירה לא צמודה**  

**מדמ"ח**  

**במסגרת תכנית אלפא בטכניון – מכון טכנולוגי לישראל**  

**פרטי התלמיד:**  

שם  החוקר הצעיר: יפתח שלו

מס' תעודת הזהות:  215631045  

שם בית-הספר: אורט טיבעון ע"ש גרינברג  נייד להתקשרות: 0546395717  

`  `**[** iftachshalev30115@gmail.com ](mailto:iftachshalev30115@gmail.com)**:כתובת המייל

**פרטי המנחה:**

שם המנחה האקדמי: פרופ' מארק זילברשטיין   שם המנחה בפועל: פבל ליפשיץ  

תעודת הזהות: 306108531  תאריך לידה: 6.5.83  

ארץ לידה: רוסיה (ברה"מ לשעבר)  

`  `B.Sc. Electrical Engineering  :תואר האקדמי   software systems & signal processing :תחום ההתמחות

שם מוסד המחקר המלווה: הטכניון - מכון טכנולוגי לישראל  נייד להתקשרות: 0542166788  

pavel.lif@gmail.com** :כתובת המייל

**א. תחום הדעת:** מדעי המחשב  

**ב. נושא העבודה:** 

מציאת פרצות חדשות במעבד מסוג ארם (arm) באמצעות הרחבת מנגנון הרביזור למעבד זה.  

**ג.  מטרות העבודה:** 

התאמת הרביזור למעבד מסוג ארם ובדיקת קיום פרצות (מסוג spectre ו - meltdown) אשר עדיין לא נתגלו בו המנצלות את חולשות ההרצה הספקולטיבית.  

**ד. הבעיה או הטיעון המועלה לדיון:**  

הרביזור מוגבל לעבודה על מספר מצומצם של מעבדים (Intel x86) ולכן עלולות להיות עוד דליפות מידע במעבדים אחרים אליהן אנו איננו מודעים. במחקר הנוכחי, תורחב פעולתו של הרביזור לפעולה על מעבד מסוג ארם במטרה לאפשר בעתיד למנוע ולהכיר פרצות שאינן ידועות כיום המנצלות חולשות של הרצה ספקולטיבית.  

**ה. הרקע העיוני**  

המעבד, הוא רכיב מרכזי של מחשב המבצע את רוב פעולות החישוב ועיבוד הנתונים של המחשב. רמתו ומהירותו של המעבד נקבעות לפי מהירות השעון של המחשב (GHz) ומספר ליבותיו. מאז המצאת המחשב היה צורך ושאיפה רבה לשפר את ביצועיו שכן כל שיפור מסוג זה גורם לחוויית משתמש טובה יותר וביצוע משימות חשובות בצורה יעילה ומהירה יותר.  

הרצה ספקולטיבית (Speculative execution)[1] זוהי שיטה בה מעבדים משתמשים על מנת לשפר ביצועים. שיטה זו מאפשרת למעבד לבצע פקודות או פעולות אשר עשויות שלא להיות נחוצות באופן מידי, אך יכולות להיות נחוצות בעתיד הקרוב. במקרה בו המעבד גילה שפעולות אלו לא היו אמורות לקרות, הוא מחזיר את תוצאותיהן לאחור ומבטל את השפעותיהן. כך יכול המעבד לעבוד על פעולות נחוצות להערכתו, במקום לחכות לביצוע ההוראות באופן מפורש, דבר אשר ישפר את מהירות המערכת כולה.  

לדוגמא:  if 10 > len(array): x = 4  

במקרה זה על מנת למצוא את אורך הרשימה יש צורך לגשת לזיכרון (פעולה אשר דורשת זמן רב) ולכן באמצעות שימוש בהרצה ספקולטיבית המעבד  קובע כי פרמטר  x יקבל את הערך 4 תוך כדי שהמעבד בודק אם אורך המערך קטן מ - 10. אם יתברר שכן, אז נחסך זמן. במידה ויתברר אחרת הפעולה תתבטל. כך מתאפשר למעבד "להריץ" את הפקודות ולבדוק אם הוא צריך לעשות זאת במקביל.  

בעקבות התפתחות טכנולוגיית ההרצה הספקולטיבית במעבדים, בשנת 2018 התגלו מספר פרצות (spectre and meltdown) המנצלות חולשות אבטחה מסוימות וגורמות למעבד להריץ את הרצה ספקולטיבית באופן המאפשר לתוקפים לגשת לנתונים רגישים המאוחסנים בזיכרון כולל סיסמאות, מפתחות הצפנה וכו'.  

spectre - פרצה אשר עשויה להשפיע על מעבדים מחברות: אינטל, איי אם דיי, וארם, והיא מאפשרת לתוקפים לגשת לנתונים רגישים באמצעות מניפולציה על המעבד אשר גורמת לו לבצע הרצה ספקולטיבית במקרה בו לא היה עושה זאת. פעולה זו נעשית על ידי יצירת מצב בו המעבד צריך לבחור בין שני נתיבי ביצוע שונים והתוקף יכול להשפיע על נתיב הביצוע בו המעבד בוחר[2].  

meltdown - פרצה המשפיעה על מעבדים מחברת אינטל בלבד. באמצעותה, ניתן להשיג מידע של תוכנות אחרות במחשב. תוקף המשתמש בפרצת meltdown ינסה לקרוא קטע מידע מכתובת בזיכרון אליה אין לו גישה. מערכת ההפעלה, כמובן, תזהה שפעולה זו אינה חוקית ותחזיר הודעת שגיאה 

(segmentation fault), אך בשלב זה בעקבות הרצה ספקולטיבית המעבד כבר ביצע את הפעולה אבל 

לא יחזיר את המידע לתוקף שכן הפעולה בוטלה. לאחר ביטול הפעולה, המידע שכבר הובא מהזיכרון נשמר בקאש.  

הקאש הוא "בלוק" של זיכרון קטן יחסית שנמצא קרוב למעבד, ולכן הוא יותר מהיר מהזיכרון המרכזי בכמעט שני סדרי גודל. לתוקף אין גישה לקאש ולכן ישתמש בטכניקות מסוימות (לדוגמה  + flash reload) באמצעותה הוא יכול להשתמש בערוצי צד[1]. ערוץ צד הוא כל דבר במערכת חשמלית שיכול להעביר או להדליף מידע. לדוגמה שינוי בלתי נמנע במחשב שתוכנה אחת מבצעת, אשר גם תוכנות אחרות מסוגלות לגשת אליו. לערוצים במערכת יש שני סוגים: ערוצים חוקיים - אלה שנועדו להעברת מידע, וערוצים משניים. דוגמאות לערוצים חוקיים כוללים אינטרנט, זיכרון משותף ועוד. מצב הקאש והפרשי מתחים הם דוגמאות לערוצים משניים. במקרה של התקיפה המתוארת ערוץ צד בו ישתמש התוקף הינו הזמן שלוקח למעבד לגשת למערך של אותיות במיקום הכתובת הלא חוקית, אם המחשב משתמש במעט זמן מהרגיל סימן שאות זו הייתה בקאש והיא אחת האותיות של המידע אותו התוקף מנסה להשיג. כך יעבור התוקף אות אחר אות עד שישיג את כל המידע שרצה.  

כיום אי ן בנמצא פתרון מספיק טוב לדליפות מידע מהסוגים אשר פורטו מעלה, המונע ממידע לדלוף תוך שימור רמת ביצוע גבוהה של המעבד, ולכן הומצא הרביזור (revizor).  

הרביזור ]3[, הינו כלי המסוגל לזהות בצורה אוטומטית דליפות מידע מהסוגים הנ"ל. את זיהוי זה הוא עושה באמצעות חוזים )contracts(]4[ אשר קובעים את תופעות הלוואי המורשות אשר יכולות להתרחש במעבד בעקבות הרצת תוכנה מסוימת )איור 1(. את תוצאות חוזים אלו ניתן להשוות עם הדליפות אשר אירעו במעבד בעקבות הרצת התוכנה. אם יש אי התאמה בין כמות הדליפה המותרת לבין כמות המידע אשר דלף סימן שקיימת פרצה.  

![ref1]

*דוגמה של חוזה המדגים אילו דליפות הגיוני שיקרו בפעולות של תוכנה מסוימת [3]*  

תוצאות הרצת התוכנה על החוזה נקראות: עקבות החוזה )contract trace( והן נשמרות בתוך מערך לפי המספר שמסמל את הדליפה. על מנת למצוא את תוצאות הרצת התוכנה על המעבד )hardware trace( 

צריך לקרוא את מצב המיקרו ארכיטקטורה של המחשב פעם אחת, ולאחר הרצת התוכנה לעשות זאת שוב וכך לקבל מפת ביטים, אשר בה כל ביט שהוא 1 מסמל תופעת לוואי של התוכנה על המעבד. אי אפשר להשוות את עקבות החוזה עם מפת הביטים מכיוון שהחוזה מציג את המקרה הקיצוני ביותר, ולכן צריך לבדוק האם המעבד מדליף יותר מידע מאשר החוזה מאפשר[3].  

הרביזור הוכיח את עצמו כיעיל והצליח למצוא את רוב סוגי הפרצות לאחר כ- 5 עד 120 דקות. עם זאת, הרביזור נבנה בצורה אשר מותאמת לעבודה על מספר מצומצם של מעבדים (Intel x86, x64) למרות שאת עקרון פעולתו ניתן ליישם על כל סוג של מעבד ולכן עלולות להיות עוד דליפות מידע במעבדים אחרים אליהן אנו איננו מודעים. במחקר הנוכחי, תורחב פעולתו של הרביזור לפעולה על מעבד מסוג ארם במטרה למנוע ולהכיר פרצות שאינן ידועות כיום המנצלות חולשות של הרצה ספקולטיבית.  

**ו.  פירוט עיקריו של ההיבט המחקרי של העבודה**  

1. **תוכנית העבודה המעשית**  

***ניסוי מס' 1 – ניסוי מקדים - שיחזור תוצאות ממחקר קודם***  

הורדת הרביזור והרצתו על מעבד אינטל  86X על מנת  לשחזר תוצאות מניסויים קודמים  ולהעמיק הבנה על הפרצה אשר  הרביזור ימצא. מידת ההצלחה של ניסוי זה תיבחן באמצעות השוואת תוצאותיו באותם המדדים אל מול תוצאות הניסוי המקורי במאמר הרביזור [3].  

***ניסוי מס' 2- התאמת הרביזור לסביבה***  

באמצעות לוח פיתוח )development board( של סביבת ארם]5[  ושרשרת כלים )Arm GNU Toolchain(]6[ יותאם  הרביזור לסביבה זו במתכת חשופה.  מתכת חשופה –  Bare metal  זהו תכנות ברמה נמוכה המקודד למערכת ברמת החומרה ופועל ללא מערכת הפעלה. כך יתאפשר לעשות תהליך של פאזינג )Fuzzing (.  development board הוא פלטפורמה חומרתית המיועדת עבור לינוקס שמספקת סביבה מצוינת להרצה, בדיקה ותיקון תוכנות ברמה נמוכה.  

Toolchain הוא אוסף של כלים התומכים בשפות C ו-CPP המשלב רכיבים תוכנתיים אשר פותחו על מנת לעזור בפיתוח תוכנות ומערכות הפעלה.  

פאזינג  –  שיטה למציאת באגים במערכת בה המעבד מריץ תוכנה בצורה חזרתית עם מספר גדול של קלטים אקראיים בכל הרצה. "באג" שימצא בעת פעולת הרביזור, הוא סימן לחולשה של המערכת בפני התקפות המנצלות ערוצי צד. במהלך תהליך הפאזינג, הרביזור יריץ על המעבד תוכנות אקראיות רבות, עם קלטים אקראיים רבים. אם הרביזור לא ימצא הבדל בין עקבות החוזה לעקבות החומרה עבור כל התוכנות והקלטים הללו, יקבע כי החומרה חסינה מהתקיפות הנ"ל.  

***ניסוי מס' 3- התאמות ושינויים לכלי הרביזור עד למצב של הרצתו על מעבד ארם***  

יבוצעו התאמות ושינויים לכלי הרביזור עד למצב של הרצתו על מעבד ארם. לאחר הרצתו יבדק ו  תוצאות ההרצה.  

2. **חלקו של התלמיד בביצוע המחקר:** התלמיד יבצע את כל חלקי המחקר.  

**ז.  פרקי העבודה (לא סופי)**  

**פרק ראשון: מבוא וסקירת ספרות**  

1. בעיית המחקר והרקע למחקר  
1. סקירת ספרות  
1. שאלת המחקר וההשערות**  

**פרק שני: מהלך המחקר**  

1. תיאור קצר ותמציתי של החומר החי הנחקר.  
1. שיטות וחומרים.  
1. מערך המחקר  
1. מהלך הניסוי  

**פרק שלישי: תוצאות**  

1. הממצאים**  
1. התוצאות  
1. הניתוח הסטטיסטי**  

**פרק רביעי: דיון**  

1. תמצית התוצאות  
1. התייחסות לרקע התאורטי  
1. הסבר התוצאות  
1. הסקת מסקנות  

**פרק חמישי: נספחים**  

נספחים יכולים להיות נתונים גולמיים, חישובים סטטיסטיים ועוד**.****  

**ח. רשימת מקורות ראשונית**  

1. intel, “Refined Speculative Execution Terminology,” May 2021. 
1. D. Genkin *et al.*, “Spectre Attacks: Exploiting Speculative Execution.” [Online]. Available: https://www.researchgate.net/publication/322253254 
1. O. Oleksenko, C. Fetzer, B. Köpf, and M. Silberstein, “Revizor: Testing Black-box CPUs against Speculation Contracts,” May 2021, [Online]. Available: http://arxiv.org/abs/2105.06872 
1. M. Guarnieri, B. Köpf, J. Reineke, and P. Vila, “Hardware-Software Contracts for Secure Speculation,” Jun. 2020, [Online]. Available: http://arxiv.org/abs/2006.03841 
1. “Juno Development Board.” https://developer.arm.com/Tools%20and%20Software/Juno%20Development%20Board (accessed May 14, 2023). 
1. “Arm GNU Toolchain.” https://developer.arm.com/Tools%20and%20Software/GNU%20Toolchain#Technical- Specifications (accessed May 14, 2023). 

**ט. לוח זמנים להכנת העבודה**  

אפריל )2023(- מאי )2023( - העמקת הידע ותכנון ניסויים.  

יוני )2023(- אוגוסט )2023( - איסוף נתונים, הרצת הניסויים ועיבוד תוצאות.  ספטמבר )2023(- אוקטובר )2023( - עיבוד תוצאות והסקת מסקנות.  נובמבר )2023(- מרץ )2024( – כתיבת עבודת הגמר.  
`  `36

[ref1]: Aspose.Words.85efaa03-3b57-4845-83e3-75d2efbdb217.009.jpeg
